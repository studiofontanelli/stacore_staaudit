swagger: '2.0'
info:
  description: FPDOC
  version: 1.0.0
  title: FPDOC
  contact:
    email: andrea1.fontanelli@consulenti.csi.it


# tags are used for organizing operations
tags:
- name: test
  description: test resources
- name: document
  description: manage document

#
#  @TODO: how to manage version
#
basePath: /api
schemes:
   - http

securityDefinitions:
  basicAuth:
    type: basic

security:
  - basicAuth: []


paths:
  /test/resources:
    get:
      tags:
        - test
      summary: Test resources
      description: Effettua il test dei servizi richiamati
      operationId: testResources
      security: []
      produces:
      - application/json
      responses:
        200:
          schema:
            $ref: '#/definitions/GenericResponse'
          description: OK
        500:
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorDto'
  /doc/save:
    post:
      tags:
        - document
      summary: Save document
      description: Effettua il salvataggio del documento
      operationId: saveDocument
      security:
        - basicAuth: []
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: request
          required: true
          schema:
            $ref: '#/definitions/RequestSaveDocument'
      responses:
        201:
          schema:
            $ref: '#/definitions/ResponseSaveDocument'
          description: OK
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrorDto'
        422:
          description: Errori di validazione
          schema:
            $ref: '#/definitions/ErrorDto'
        500:
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorDto'
  /doc/load/{codiceFruitore}/{idDocumento}:
    get:
      tags:
        - document
      summary: Load document
      description: carica un documento
      operationId: loadDocument
      security:
        - basicAuth: []
      produces:
        - application/json
      parameters:
        - in: path
          name: codiceFruitore
          type: string
          required: true
          description: codice fruitore
        - in: path
          name: idDocumento
          type: string
          required: true
          description: id documento
      responses:
        200:
          description: il documento
          schema:
            $ref: '#/definitions/Documento'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrorDto'
        422:
          description: Errori di validazione
          schema:
            $ref: '#/definitions/ErrorDto'
        404:
          description: Nessun dato trovato
        500:
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorDto'
definitions:
  GenericResponse:
    type: object
    description: Risposta di un servizio generico
    properties:
      message:
        type: string
        description: Contiene il messaggio eventuale del servizio chiamato
        example: 'Servizio ha risposto correttamente'
  ErrorDto:
    type: object
    description: Rappresenta l'errore restituito da servizio
    properties:
      status:
        type: integer
        description: status http restituito
        example: '500, 400, ecc'
      code:
        type: string
        description: code http restituito
        example: 'Internal server error, ecc'
      description:
        type: string
        description: la descrizione dell'errore
        example: 'Internal server error, ecc'
      errorDetails:
        type: array
        description: i dettagli errore
        items:
          $ref: '#/definitions/ErrorDetail'
  ErrorDetail:
    type: object
    description: rappresenta il dettaglio errore restituito in caso di errori di validazione sui campi di input
    properties:
      field:
        type: string
        description: il nome del campo per cui è falita la validazione
        example: 'name, surname'
      error:
        type: string
        description: l'errore di validazione effettivo
        example: 'campo obbligatorio, ecc'
      description:
        type: string
        description: la descrizione dell'errore
        example: 'Internal server error, ecc'
  RequestLoadDocument:
    type: object
    description: è la richiesta per il caricamento di un documento
    properties:
      codiceFuitore:
        type: string
        description: il codice fruitore
      idDocumento:
        type: string
        description: la chiave del documento
    required:
      - codiceFuitore
      - idDocumento
  RequestSaveDocument:
    type: object
    description: è la richiesta per il salvataggio di un documento
    properties:
      documento:
        type: object
        description: il documento da salvare
        $ref: '#/definitions/Documento'
      codiceFuitore:
        type: string
        description: il codice fruitore
      tipoDocumento:
        type: string
        description: la tipologia documento
      folder:
        type: string
        description: folder in cui salvare il file
      metadata:
        type: array
        description: l'elenco degli eventuali metadati associati al documento
        items:
          $ref: '#/definitions/Metadata'
      identificativoDocumentoFornitore:
        type: string
        description: eventuale chiave univoca che il fornitore vuole associare al documento
    required:
      - document
      - codiceFuitore
      - tipoDocumento
  ResponseSaveDocument:
    type: object
    description: La risposta al salvataggio di un documento
    properties:
      id:
        type: string
        description: codice univoco documento
    required:
      - id
  Documento:
    type: object
    description: rappresenta il documento da salvare
    properties:
      nome:
        type: string
        description: il nome del documento
      mimeType:
        type: string
        description: il mimetype del documento
        example: application/pdf
      file:
        type: string
        format: byte
        description: il file
    required:
      - nome
      - file
  Metadata:
    type: object
    description: metadato generico
    properties:
      key:
        type: string
        description: metadata key
      value:
        type: string
        description: metadata value
      type:
        type: string
        description: metadata type
        example:
    required:
      - key
      - value